openapi: 3.0.3
info:
  title: FitrahTube API
  version: 1.0.0
  description: |
    REST API for FitrahTube backend. Production implementation with 113+ endpoints across 14 controllers.

    **Key Features:**
    - Public content API for Android app (no auth required)
    - Admin/moderator content management with approval workflows
    - YouTube integration for content discovery
    - Bulk import/export functionality
    - Video validation and health monitoring
    - Comprehensive audit logging

    **Authentication:**
    - Firebase Authentication with JWT tokens
    - Role-based access: ADMIN, MODERATOR
    - Public endpoints require no authentication

    **Pagination:**
    - Cursor-based pagination for infinite scroll
    - Page-based pagination for admin interfaces

    **Caching:**
    - Categories: 1 hour TTL
    - Channels: 15 minutes TTL
    - YouTube searches: Varies by type

servers:
  - url: http://localhost:8080/api
    description: Local Development
  - url: http://192.168.1.167:8080/api
    description: Local Network (Android Testing)
  - url: https://api.albunyaan.com/api
    description: Production

security:
  - bearerAuth: []

tags:
  - name: Public Content
    description: Public API for mobile app (no auth required)
  - name: Categories
    description: Category management (hierarchical tree)
  - name: Channels
    description: Channel management with approval workflow
  - name: Playlists
    description: Playlist management (via Registry)
  - name: Videos
    description: Video management (via Registry)
  - name: Registry
    description: Internal content registry API (admin workflow)
  - name: YouTube
    description: YouTube Data API integration
  - name: Users
    description: Admin and moderator user management
  - name: Audit
    description: Audit log viewing
  - name: Dashboard
    description: Analytics and metrics
  - name: Approvals
    description: Content approval workflow
  - name: Player
    description: Player functionality (recommendations)
  - name: Downloads
    description: Video download management
  - name: Import/Export
    description: Bulk data import and export
  - name: Validation
    description: Video validation and health checks
  - name: Content Library
    description: Unified content library management
  - name: Exclusions
    description: Workspace-level exclusion management

paths:
  # ============================================================================
  # PUBLIC CONTENT API (No Authentication Required)
  # ============================================================================

  /v1/content:
    get:
      summary: Get paginated content for mobile app
      description: |
        Fetch content filtered by type (HOME, CHANNELS, PLAYLISTS, VIDEOS).
        Returns cursor-paginated results for infinite scroll.
      operationId: getPublicContent
      tags: [Public Content]
      security: []
      parameters:
        - name: type
          in: query
          schema:
            type: string
            enum: [HOME, CHANNELS, PLAYLISTS, VIDEOS]
            default: HOME
        - name: cursor
          in: query
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 20
        - name: category
          in: query
          description: Filter by category slug
          schema:
            type: string
        - name: length
          in: query
          schema:
            type: string
            enum: [SHORT, MEDIUM, LONG]
        - name: date
          in: query
          schema:
            type: string
            enum: [LAST_24_HOURS, LAST_7_DAYS, LAST_30_DAYS]
        - name: sort
          in: query
          schema:
            type: string
            enum: [DEFAULT, MOST_POPULAR, NEWEST]
      responses:
        '200':
          description: Content page
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/CursorPageDto'
                  - type: object
                    description: Cursor-paginated mixed content response
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/ContentItemDto'

  /v1/categories:
    get:
      summary: List all active categories
      operationId: listPublicCategories
      tags: [Public Content]
      security: []
      responses:
        '200':
          description: Category list (simplified DTOs without admin metadata)
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CategoryDto'

  /v1/home:
    get:
      summary: Get paginated home feed with category sections
      description: |
        Returns categories in admin-defined displayOrder, each containing up to
        contentLimit items in admin-defined sort order. Supports cursor-based
        pagination for infinite scroll of category sections.
      operationId: getHomeFeed
      tags: [Public Content]
      security: []
      parameters:
        - name: cursor
          in: query
          description: Base64-encoded cursor from previous page
          schema:
            type: string
        - name: categoryLimit
          in: query
          description: Max categories per page
          schema:
            type: integer
            minimum: 1
            maximum: 10
            default: 5
        - name: contentLimit
          in: query
          description: Max items per category
          schema:
            type: integer
            minimum: 1
            maximum: 20
            default: 10
      responses:
        '200':
          description: Paginated home feed
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/CursorPageDto'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/HomeCategoryDto'

  /v1/channels/{channelId}:
    get:
      summary: Get channel details by YouTube ID
      operationId: getPublicChannel
      tags: [Public Content]
      security: []
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
          description: YouTube channel ID
      responses:
        '200':
          description: Channel entity (without nested playlists)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Channel'
        '404':
          description: Channel not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/playlists/{playlistId}:
    get:
      summary: Get playlist details by YouTube ID
      operationId: getPublicPlaylist
      tags: [Public Content]
      security: []
      parameters:
        - name: playlistId
          in: path
          required: true
          schema:
            type: string
          description: YouTube playlist ID
      responses:
        '200':
          description: Playlist entity (without nested videos)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Playlist'
        '404':
          description: Playlist not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/videos/{videoId}:
    get:
      summary: Get video details by YouTube ID
      operationId: getPublicVideo
      tags: [Public Content]
      security: []
      parameters:
        - name: videoId
          in: path
          required: true
          schema:
            type: string
          description: YouTube video ID
      responses:
        '200':
          description: Video entity with metadata and approval status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Video'
        '404':
          description: Video not found or not approved/available
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /v1/search:
    get:
      summary: Search across all content types
      operationId: searchPublicContent
      tags: [Public Content]
      security: []
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
        - name: type
          in: query
          schema:
            type: string
            enum: [CHANNELS, PLAYLISTS, VIDEOS]
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 20
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ContentItemDto'
                description: Array of matching content items (not paginated)

  # ============================================================================
  # SORT ORDER (Admin)
  # ============================================================================

  /admin/sort/categories:
    get:
      summary: Get categories in sort order with content counts
      operationId: getCategorySortOrder
      tags: [Sort Order]
      responses:
        '200':
          description: Categories sorted by displayOrder
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CategorySortDto'

  /admin/sort/categories/reorder:
    put:
      summary: Reorder a category (insert-and-shift)
      operationId: reorderCategory
      tags: [Sort Order]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [categoryId, newPosition]
              properties:
                categoryId:
                  type: string
                newPosition:
                  type: integer
                  minimum: 0
      responses:
        '200':
          description: Updated category sort order
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CategorySortDto'

  /admin/sort/categories/{categoryId}/content:
    get:
      summary: Get content items in sort order within a category
      operationId: getCategoryContentOrder
      tags: [Sort Order]
      parameters:
        - name: categoryId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Content items sorted by position
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ContentSortDto'

  /admin/sort/categories/{categoryId}/content/reorder:
    put:
      summary: Reorder content within a category (insert-and-shift)
      operationId: reorderContentInCategory
      tags: [Sort Order]
      parameters:
        - name: categoryId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [contentId, contentType, newPosition]
              properties:
                contentId:
                  type: string
                contentType:
                  type: string
                  enum: [channel, playlist, video]
                newPosition:
                  type: integer
                  minimum: 0
      responses:
        '200':
          description: Updated content sort order
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ContentSortDto'

  # ============================================================================
  # CATEGORIES (Admin/Moderator)
  # ============================================================================

  /admin/categories:
    get:
      summary: List all categories (hierarchical)
      operationId: listCategories
      tags: [Categories]
      responses:
        '200':
          description: Category tree
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'
    post:
      summary: Create new category
      operationId: createCategory
      tags: [Categories]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Category'
      responses:
        '201':
          description: Category created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'

  /admin/categories/top-level:
    get:
      summary: Get top-level categories only
      operationId: listTopLevelCategories
      tags: [Categories]
      responses:
        '200':
          description: Top-level categories
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'

  /admin/categories/{parentId}/subcategories:
    get:
      summary: Get subcategories of a parent
      operationId: listSubcategories
      tags: [Categories]
      parameters:
        - name: parentId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Subcategories
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'

  /admin/categories/{id}:
    get:
      summary: Get category by ID
      operationId: getCategory
      tags: [Categories]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Category
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
    put:
      summary: Update category
      operationId: updateCategory
      tags: [Categories]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Category'
      responses:
        '200':
          description: Category updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
    delete:
      summary: Delete category (fails if has subcategories)
      operationId: deleteCategory
      tags: [Categories]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Category deleted

  # ============================================================================
  # CHANNELS (Admin/Moderator)
  # ============================================================================

  /admin/channels:
    get:
      summary: List channels with optional status filter
      operationId: listChannels
      tags: [Channels]
      parameters:
        - name: status
          in: query
          schema:
            type: string
            default: approved
      responses:
        '200':
          description: Channel list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Channel'
    post:
      summary: Submit channel for approval
      description: Admins auto-approve, moderators submit as pending
      operationId: createChannel
      tags: [Channels]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Channel'
      responses:
        '201':
          description: Channel created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Channel'

  /admin/channels/category/{categoryId}:
    get:
      summary: Get channels by category
      operationId: getChannelsByCategory
      tags: [Channels]
      parameters:
        - name: categoryId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Channels in category
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Channel'

  /admin/channels/{id}:
    get:
      summary: Get channel by ID
      operationId: getChannel
      tags: [Channels]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Channel
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Channel'
    delete:
      summary: Delete channel
      operationId: deleteChannel
      tags: [Channels]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Channel deleted

  /admin/channels/{id}/approve:
    put:
      summary: Approve channel
      operationId: approveChannel
      tags: [Channels]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Channel approved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Channel'

  /admin/channels/{id}/reject:
    put:
      summary: Reject channel
      operationId: rejectChannel
      tags: [Channels]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Channel rejected
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Channel'

  /admin/channels/{id}/exclusions:
    get:
      summary: Get channel exclusions
      operationId: getChannelExclusions
      tags: [Channels]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Exclusions
          content:
            application/json:
              schema:
                type: object
    put:
      summary: Update channel exclusions (bulk)
      operationId: updateChannelExclusions
      tags: [Channels]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Exclusions updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Channel'

  /admin/channels/{id}/exclusions/{type}/{youtubeId}:
    post:
      summary: Add single exclusion to channel
      operationId: addChannelExclusion
      tags: [Channels]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - name: type
          in: path
          required: true
          schema:
            type: string
            enum: [video, playlist, livestream, short, post]
        - name: youtubeId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Exclusion added
    delete:
      summary: Remove single exclusion from channel
      operationId: removeChannelExclusion
      tags: [Channels]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - name: type
          in: path
          required: true
          schema:
            type: string
            enum: [video, playlist, livestream, short, post]
        - name: youtubeId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Exclusion removed

  # ============================================================================
  # REGISTRY (Admin/Moderator - Internal Workflow API)
  # ============================================================================

  /admin/registry/channels:
    get:
      summary: List all channels in registry
      operationId: registryListChannels
      tags: [Registry]
      responses:
        '200':
          description: Channels
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Channel'
    post:
      summary: Add channel to registry
      operationId: registryAddChannel
      tags: [Registry]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Channel'
      responses:
        '201':
          description: Channel added
        '409':
          description: Channel already exists

  /admin/registry/channels/status/{status}:
    get:
      summary: Get channels by status
      operationId: registryGetChannelsByStatus
      tags: [Registry]
      parameters:
        - name: status
          in: path
          required: true
          schema:
            type: string
            enum: [PENDING, APPROVED, REJECTED]
      responses:
        '200':
          description: Channels
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Channel'

  /admin/registry/channels/{id}:
    get:
      summary: Get channel by ID
      operationId: registryGetChannel
      tags: [Registry]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Channel
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Channel'
    put:
      summary: Update channel in registry
      operationId: registryUpdateChannel
      tags: [Registry]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Channel'
      responses:
        '200':
          description: Channel updated
    delete:
      summary: Delete channel from registry
      operationId: registryDeleteChannel
      tags: [Registry]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Channel deleted

  /admin/registry/channels/{id}/toggle:
    patch:
      summary: Toggle channel APPROVED/PENDING status
      operationId: registryToggleChannel
      tags: [Registry]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Status toggled

  /admin/registry/playlists:
    get:
      summary: List all playlists in registry
      operationId: registryListPlaylists
      tags: [Registry]
      responses:
        '200':
          description: Playlists
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Playlist'
    post:
      summary: Add playlist to registry
      operationId: registryAddPlaylist
      tags: [Registry]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Playlist'
      responses:
        '201':
          description: Playlist added
        '409':
          description: Playlist already exists

  /admin/registry/playlists/status/{status}:
    get:
      summary: Get playlists by status
      operationId: registryGetPlaylistsByStatus
      tags: [Registry]
      parameters:
        - name: status
          in: path
          required: true
          schema:
            type: string
            enum: [PENDING, APPROVED, REJECTED]
      responses:
        '200':
          description: Playlists
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Playlist'

  /admin/registry/playlists/{id}:
    get:
      summary: Get playlist by ID
      operationId: registryGetPlaylist
      tags: [Registry]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Playlist
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Playlist'
    put:
      summary: Update playlist in registry
      operationId: registryUpdatePlaylist
      tags: [Registry]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Playlist'
      responses:
        '200':
          description: Playlist updated
    delete:
      summary: Delete playlist from registry
      operationId: registryDeletePlaylist
      tags: [Registry]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Playlist deleted

  /admin/registry/playlists/{id}/toggle:
    patch:
      summary: Toggle playlist APPROVED/PENDING status
      operationId: registryTogglePlaylist
      tags: [Registry]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Status toggled

  /admin/registry/playlists/{id}/exclusions:
    get:
      summary: Get playlist exclusions (excluded video IDs)
      operationId: getPlaylistExclusions
      tags: [Registry]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Excluded video IDs
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string

  /admin/registry/playlists/{id}/exclusions/{videoId}:
    post:
      summary: Add video exclusion to playlist
      operationId: addPlaylistExclusion
      tags: [Registry]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - name: videoId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Exclusion added
    delete:
      summary: Remove video exclusion from playlist
      operationId: removePlaylistExclusion
      tags: [Registry]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
        - name: videoId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Exclusion removed

  /admin/registry/videos:
    get:
      summary: List all videos in registry
      operationId: registryListVideos
      tags: [Registry]
      responses:
        '200':
          description: Videos
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Video'
    post:
      summary: Add video to registry
      operationId: registryAddVideo
      tags: [Registry]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Video'
      responses:
        '201':
          description: Video added
        '409':
          description: Video already exists

  /admin/registry/videos/status/{status}:
    get:
      summary: Get videos by status
      operationId: registryGetVideosByStatus
      tags: [Registry]
      parameters:
        - name: status
          in: path
          required: true
          schema:
            type: string
            enum: [PENDING, APPROVED, REJECTED]
      responses:
        '200':
          description: Videos
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Video'

  /admin/registry/videos/{id}:
    get:
      summary: Get video by ID
      operationId: registryGetVideo
      tags: [Registry]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Video
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Video'
    put:
      summary: Update video in registry
      operationId: registryUpdateVideo
      tags: [Registry]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Video'
      responses:
        '200':
          description: Video updated
    delete:
      summary: Delete video from registry
      operationId: registryDeleteVideo
      tags: [Registry]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Video deleted

  /admin/registry/videos/{id}/toggle:
    patch:
      summary: Toggle video APPROVED/PENDING status
      operationId: registryToggleVideo
      tags: [Registry]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Status toggled

  # ============================================================================
  # YOUTUBE INTEGRATION (Admin/Moderator)
  # ============================================================================

  /admin/youtube/search/unified:
    get:
      summary: Unified search - mixed results (single API call)
      operationId: youtubeSearchUnified
      tags: [YouTube]
      parameters:
        - name: query
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Mixed search results
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/EnrichedSearchResult'

  /admin/youtube/search/all:
    get:
      summary: Search all content types with pagination
      operationId: youtubeSearchAll
      tags: [YouTube]
      parameters:
        - name: query
          in: query
          required: true
          schema:
            type: string
        - name: pageToken
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Paginated search results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchPageResponse'

  /admin/youtube/search/channels:
    get:
      summary: Search for channels
      operationId: youtubeSearchChannels
      tags: [YouTube]
      parameters:
        - name: query
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Channel search results
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/EnrichedSearchResult'

  /admin/youtube/search/playlists:
    get:
      summary: Search for playlists
      operationId: youtubeSearchPlaylists
      tags: [YouTube]
      parameters:
        - name: query
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Playlist search results
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/EnrichedSearchResult'

  /admin/youtube/search/videos:
    get:
      summary: Search for videos
      operationId: youtubeSearchVideos
      tags: [YouTube]
      parameters:
        - name: query
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Video search results
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/EnrichedSearchResult'

  /admin/youtube/check-existing:
    post:
      summary: Check which YouTube IDs already exist in registry
      operationId: youtubeCheckExisting
      tags: [YouTube]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExistingContentRequest'
      responses:
        '200':
          description: Existing content IDs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExistingContentResponse'

  /admin/youtube/channels/{channelId}:
    get:
      summary: Get channel details from YouTube
      operationId: youtubeGetChannel
      tags: [YouTube]
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: YouTube channel
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChannelDetailsDto'

  /admin/youtube/channels/{channelId}/videos:
    get:
      summary: Get videos from YouTube channel
      operationId: youtubeGetChannelVideos
      tags: [YouTube]
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
        - name: pageToken
          in: query
          schema:
            type: string
        - name: q
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Channel videos (paginated)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedStreamItems'

  /admin/youtube/channels/{channelId}/shorts:
    get:
      summary: Get shorts from YouTube channel
      operationId: youtubeGetChannelShorts
      tags: [YouTube]
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
        - name: pageToken
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Channel shorts (paginated)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedStreamItems'

  /admin/youtube/channels/{channelId}/livestreams:
    get:
      summary: Get live streams from YouTube channel
      operationId: youtubeGetChannelLiveStreams
      tags: [YouTube]
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
        - name: pageToken
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Channel live streams (paginated)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedStreamItems'

  /admin/youtube/channels/{channelId}/playlists:
    get:
      summary: Get playlists from YouTube channel
      operationId: youtubeGetChannelPlaylists
      tags: [YouTube]
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
        - name: pageToken
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Channel playlists (paginated)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedPlaylistItems'

  /admin/youtube/playlists/{playlistId}:
    get:
      summary: Get playlist details from YouTube
      operationId: youtubeGetPlaylist
      tags: [YouTube]
      parameters:
        - name: playlistId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: YouTube playlist
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlaylistDetailsDto'

  /admin/youtube/playlists/{playlistId}/videos:
    get:
      summary: Get videos in YouTube playlist
      operationId: youtubeGetPlaylistVideos
      tags: [YouTube]
      parameters:
        - name: playlistId
          in: path
          required: true
          schema:
            type: string
        - name: pageToken
          in: query
          schema:
            type: string
        - name: q
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Playlist videos (paginated)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedStreamItems'

  /admin/youtube/videos/{videoId}:
    get:
      summary: Get video details from YouTube
      operationId: youtubeGetVideo
      tags: [YouTube]
      parameters:
        - name: videoId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: YouTube video
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StreamDetailsDto'

  # ============================================================================
  # USER MANAGEMENT (Admin Only)
  # ============================================================================

  /admin/users:
    get:
      summary: List all users
      operationId: listUsers
      tags: [Users]
      responses:
        '200':
          description: User list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
    post:
      summary: Create new user
      operationId: createUser
      tags: [Users]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password, displayName, role]
              properties:
                email:
                  type: string
                password:
                  type: string
                displayName:
                  type: string
                role:
                  type: string
                  enum: [admin, moderator]
      responses:
        '201':
          description: User created

  /admin/users/{uid}:
    get:
      summary: Get user by Firebase UID
      operationId: getUser
      tags: [Users]
      parameters:
        - name: uid
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: User
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
    delete:
      summary: Delete user
      operationId: deleteUser
      tags: [Users]
      parameters:
        - name: uid
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: User deleted

  /admin/users/role/{role}:
    get:
      summary: Get users by role
      operationId: getUsersByRole
      tags: [Users]
      parameters:
        - name: role
          in: path
          required: true
          schema:
            type: string
            enum: [admin, moderator]
      responses:
        '200':
          description: Users with role

  /admin/users/{uid}/role:
    put:
      summary: Update user role
      operationId: updateUserRole
      tags: [Users]
      parameters:
        - name: uid
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [role]
              properties:
                role:
                  type: string
                  enum: [admin, moderator]
      responses:
        '200':
          description: Role updated

  /admin/users/{uid}/status:
    put:
      summary: Update user status (activate/deactivate)
      operationId: updateUserStatus
      tags: [Users]
      parameters:
        - name: uid
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [status]
              properties:
                status:
                  type: string
                  enum: [active, inactive]
      responses:
        '200':
          description: Status updated

  /admin/users/{uid}/reset-password:
    post:
      summary: Send password reset email
      operationId: resetUserPassword
      tags: [Users]
      parameters:
        - name: uid
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Reset email sent

  # ============================================================================
  # AUDIT LOGS (Admin Only)
  # ============================================================================

  /admin/audit:
    get:
      summary: Get recent audit logs
      operationId: listAuditLogs
      tags: [Audit]
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 100
      responses:
        '200':
          description: Audit logs
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AuditLog'

  /admin/audit/actor/{actorUid}:
    get:
      summary: Get audit logs by actor
      operationId: getAuditLogsByActor
      tags: [Audit]
      parameters:
        - name: actorUid
          in: path
          required: true
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
            default: 100
      responses:
        '200':
          description: Audit logs

  /admin/audit/entity-type/{entityType}:
    get:
      summary: Get audit logs by entity type
      operationId: getAuditLogsByEntityType
      tags: [Audit]
      parameters:
        - name: entityType
          in: path
          required: true
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
            default: 100
      responses:
        '200':
          description: Audit logs

  /admin/audit/action/{action}:
    get:
      summary: Get audit logs by action
      operationId: getAuditLogsByAction
      tags: [Audit]
      parameters:
        - name: action
          in: path
          required: true
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
            default: 100
      responses:
        '200':
          description: Audit logs

  # ============================================================================
  # DASHBOARD (Admin/Moderator)
  # ============================================================================

  /admin/dashboard:
    get:
      summary: Get dashboard metrics
      operationId: getDashboardMetrics
      tags: [Dashboard]
      parameters:
        - name: timeframe
          in: query
          schema:
            type: string
            enum: [LAST_24_HOURS, LAST_7_DAYS, LAST_30_DAYS]
            default: LAST_7_DAYS
      responses:
        '200':
          description: Dashboard metrics
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                  meta:
                    type: object

  /admin/dashboard/stats/by-category:
    get:
      summary: Get statistics by category
      operationId: getCategoryStats
      tags: [Dashboard]
      responses:
        '200':
          description: Category statistics
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  type: object

  # ============================================================================
  # APPROVALS (Admin/Moderator)
  # ============================================================================

  /admin/approvals/pending:
    get:
      summary: List pending approvals
      description: |
        Returns pending approvals with cursor-based pagination.

        **Cursor Behavior:**
        - Single-type queries (type=CHANNEL or type=PLAYLIST): Uses standard cursor encoding with document ID and createdAt timestamp.
        - Mixed-type queries (type omitted): Uses composite cursor that encodes separate positions for channels and playlists collections to ensure monotonic pagination across collections.

        **Ordering:**
        - Results are ordered by createdAt DESC, with document ID as secondary sort for deterministic ordering when timestamps collide.

        **Cursor Format:**
        - Cursors are opaque, URL-safe Base64 tokens. Clients should not parse or construct cursorsâ€”always use the `nextCursor` value from previous response.
      operationId: listPendingApprovals
      tags: [Approvals]
      parameters:
        - name: type
          in: query
          description: Filter by content type. Omit to get both channels and playlists merged by timestamp.
          schema:
            type: string
            enum: [CHANNEL, PLAYLIST]
        - name: category
          in: query
          description: Filter by category ID
          schema:
            type: string
        - name: limit
          in: query
          description: Number of items per page (default 20)
          schema:
            type: integer
            default: 20
        - name: cursor
          in: query
          description: Opaque cursor token from previous response's pageInfo.nextCursor
          schema:
            type: string
      responses:
        '200':
          description: Pending approvals
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/CursorPageDto'
                  - type: object
                    description: Cursor-paginated pending approvals
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/PendingApprovalDto'

  /admin/approvals/{id}/approve:
    post:
      summary: Approve pending item
      operationId: approvePendingItem
      tags: [Approvals]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                reviewNotes:
                  type: string
                categoryOverride:
                  type: string
      responses:
        '200':
          description: Item approved

  /admin/approvals/{id}/reject:
    post:
      summary: Reject pending item
      operationId: rejectPendingItem
      tags: [Approvals]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [reason]
              properties:
                reason:
                  type: string
                reviewNotes:
                  type: string
      responses:
        '200':
          description: Item rejected

  # ============================================================================
  # PLAYER (Public)
  # ============================================================================

  /player/next-up/{videoId}:
    get:
      summary: Get next-up video recommendations
      operationId: getNextUp
      tags: [Player]
      security: []
      parameters:
        - name: videoId
          in: path
          required: true
          schema:
            type: string
        - name: userId
          in: query
          schema:
            type: string
          description: User ID for personalized recommendations (future use)
      responses:
        '200':
          description: Recommended videos (up to 10 items)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NextUpDto'

  # ============================================================================
  # DOWNLOADS (Public/User)
  # ============================================================================

  /downloads/policy/{videoId}:
    get:
      summary: Check download policy for video
      operationId: getDownloadPolicy
      tags: [Downloads]
      security: []
      parameters:
        - name: videoId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Download policy

  /downloads/token/{videoId}:
    post:
      summary: Generate download token
      operationId: generateDownloadToken
      tags: [Downloads]
      security: []
      parameters:
        - name: videoId
          in: path
          required: true
          schema:
            type: string
          description: YouTube video ID
      requestBody:
        required: true
        description: EULA acceptance confirmation
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DownloadTokenRequest'
      responses:
        '200':
          description: Download token generated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DownloadTokenDto'
        '400':
          description: Invalid request (missing or invalid eulaAccepted)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: EULA not accepted or policy violation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Video not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /downloads/manifest/{videoId}:
    get:
      summary: Get download manifest
      operationId: getDownloadManifest
      tags: [Downloads]
      security: []
      parameters:
        - name: videoId
          in: path
          required: true
          schema:
            type: string
        - name: token
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Download manifest
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DownloadManifestDto'
        '403':
          description: Invalid or expired token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Video not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /downloads/analytics/download-started:
    post:
      summary: Track download started event
      operationId: trackDownloadStarted
      tags: [Downloads]
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DownloadStartedEvent'
      responses:
        '201':
          description: Event tracked

  /downloads/analytics/download-completed:
    post:
      summary: Track download completed event
      operationId: trackDownloadCompleted
      tags: [Downloads]
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DownloadCompletedEvent'
      responses:
        '201':
          description: Event tracked

  /downloads/analytics/download-failed:
    post:
      summary: Track download failed event
      operationId: trackDownloadFailed
      tags: [Downloads]
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DownloadFailedEvent'
      responses:
        '201':
          description: Event tracked

  # ============================================================================
  # IMPORT/EXPORT (Admin Only)
  # ============================================================================

  /admin/import-export/export:
    get:
      summary: Export all content as JSON (full format)
      operationId: exportAll
      tags: [Import/Export]
      parameters:
        - name: includeCategories
          in: query
          schema:
            type: boolean
            default: true
        - name: includeChannels
          in: query
          schema:
            type: boolean
            default: true
        - name: includePlaylists
          in: query
          schema:
            type: boolean
            default: true
        - name: includeVideos
          in: query
          schema:
            type: boolean
            default: true
        - name: excludeUnavailableVideos
          in: query
          schema:
            type: boolean
            default: true
      responses:
        '200':
          description: JSON file download
          content:
            application/json:
              schema:
                type: object

  /admin/import-export/export/categories:
    get:
      summary: Export only categories
      operationId: exportCategories
      tags: [Import/Export]
      responses:
        '200':
          description: JSON file download

  /admin/import-export/export/channels:
    get:
      summary: Export only channels
      operationId: exportChannels
      tags: [Import/Export]
      responses:
        '200':
          description: JSON file download

  /admin/import-export/export/playlists:
    get:
      summary: Export only playlists
      operationId: exportPlaylists
      tags: [Import/Export]
      responses:
        '200':
          description: JSON file download

  /admin/import-export/export/videos:
    get:
      summary: Export only videos
      operationId: exportVideos
      tags: [Import/Export]
      parameters:
        - name: excludeUnavailableVideos
          in: query
          schema:
            type: boolean
            default: true
      responses:
        '200':
          description: JSON file download

  /admin/import-export/import:
    post:
      summary: Import content from JSON file (full format)
      operationId: importContent
      tags: [Import/Export]
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
                mergeStrategy:
                  type: string
                  enum: [SKIP, OVERWRITE, MERGE]
                  default: SKIP
      responses:
        '200':
          description: Import results

  /admin/import-export/import/validate:
    post:
      summary: Validate import file without importing
      operationId: validateImport
      tags: [Import/Export]
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '200':
          description: Validation results

  /admin/import-export/export/simple:
    get:
      summary: Export in simple format (ID-to-title-categories map)
      operationId: exportSimple
      tags: [Import/Export]
      parameters:
        - name: includeChannels
          in: query
          schema:
            type: boolean
            default: true
        - name: includePlaylists
          in: query
          schema:
            type: boolean
            default: true
        - name: includeVideos
          in: query
          schema:
            type: boolean
            default: true
      responses:
        '200':
          description: JSON file download (simple format)

  /admin/import-export/import/simple:
    post:
      summary: Import from simple format
      operationId: importSimple
      tags: [Import/Export]
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
                defaultStatus:
                  type: string
                  enum: [APPROVED, PENDING]
                  default: APPROVED
      responses:
        '200':
          description: Import results

  /admin/import-export/import/simple/validate:
    post:
      summary: Validate simple format import (dry-run)
      operationId: validateSimpleImport
      tags: [Import/Export]
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '200':
          description: Validation results

  # ============================================================================
  # VIDEO VALIDATION (Admin/Moderator)
  # ============================================================================

  /admin/videos/validate:
    post:
      summary: Manually trigger video validation
      operationId: validateVideos
      tags: [Validation]
      parameters:
        - name: maxVideos
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 1000
      responses:
        '200':
          description: Validation started

  /admin/videos/validation-status/{runId}:
    get:
      summary: Get validation run status by ID
      operationId: getValidationStatus
      tags: [Validation]
      parameters:
        - name: runId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Validation run

  /admin/videos/validation-history:
    get:
      summary: Get validation history
      operationId: getValidationHistory
      tags: [Validation]
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            maximum: 100
      responses:
        '200':
          description: Validation runs

  /admin/videos/validation-latest:
    get:
      summary: Get latest validation run
      operationId: getLatestValidation
      tags: [Validation]
      responses:
        '200':
          description: Latest validation run

  # ============================================================================
  # CONTENT LIBRARY (Admin/Moderator)
  # ============================================================================

  /admin/content:
    get:
      summary: Get all content with filtering
      description: |
        Retrieves content items (channels, playlists, videos) with support for filtering,
        searching, and pagination.

        **Search Behavior:**
        Search matches against title, keywords/tags, and description fields using
        case-insensitive contains matching. This enables finding content by:
        - Partial title text (e.g., "islam" matches "Introduction to Islam")
        - Keyword tags (e.g., "quran" matches items tagged with "quran recitation")
        - Description text (e.g., "arabic" matches items with "arabic" in description)

        **Query Limits (Important):**
        To prevent Firestore quota exhaustion, this endpoint uses bounded queries that
        limit results to a maximum of 200 items per content type. When the `truncated`
        field in the response is `true`, there may be more matching items than shown.

        **Best Practices for Large Datasets:**
        - Use specific type filters (`types=channel`) instead of fetching all types
        - Apply category and status filters to narrow results
        - Use pagination (`page`, `size`) for browsing
        - For finding specific items, use the search parameter with distinctive terms
      operationId: listContent
      tags: [Content Library]
      parameters:
        - name: types
          in: query
          description: Comma-separated content types to include. Defaults to all types.
          schema:
            type: string
            example: channel,playlist,video
        - name: status
          in: query
          description: Filter by approval status
          schema:
            type: string
            enum: [all, approved, pending, rejected]
            default: all
        - name: category
          in: query
          description: Filter by category ID
          schema:
            type: string
        - name: search
          in: query
          description: |
            Search term to filter results. Matches against title, keywords, and description
            using case-insensitive contains matching. Note: Search is applied after bounded
            fetch, so results are limited to the most recent 200 items per content type.
          schema:
            type: string
        - name: sort
          in: query
          description: Sort order for results
          schema:
            type: string
            enum: [newest, oldest, custom]
            default: newest
        - name: page
          in: query
          description: Page number (0-indexed)
          schema:
            type: integer
            default: 0
        - name: size
          in: query
          description: Page size (max 100)
          schema:
            type: integer
            default: 20
            maximum: 100
      responses:
        '200':
          description: Content library page with pagination metadata
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContentLibraryResponse'

  /admin/content/bulk/approve:
    post:
      summary: Bulk approve content items
      operationId: bulkApprove
      tags: [Content Library]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [items]
              properties:
                items:
                  type: array
                  items:
                    type: object
                    required: [type, id]
                    properties:
                      type:
                        type: string
                        enum: [channel, playlist, video]
                      id:
                        type: string
      responses:
        '200':
          description: Bulk action results

  /admin/content/bulk/reject:
    post:
      summary: Bulk reject content items
      operationId: bulkReject
      tags: [Content Library]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [items]
              properties:
                items:
                  type: array
                  items:
                    type: object
                    required: [type, id]
                    properties:
                      type:
                        type: string
                        enum: [channel, playlist, video]
                      id:
                        type: string
      responses:
        '200':
          description: Bulk action results

  /admin/content/bulk/delete:
    post:
      summary: Bulk delete content items
      operationId: bulkDelete
      tags: [Content Library]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [items]
              properties:
                items:
                  type: array
                  items:
                    type: object
                    required: [type, id]
                    properties:
                      type:
                        type: string
                        enum: [channel, playlist, video]
                      id:
                        type: string
      responses:
        '200':
          description: Bulk action results

  /admin/content/bulk/assign-categories:
    post:
      summary: Bulk assign categories to content items
      operationId: bulkAssignCategories
      tags: [Content Library]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [items, categoryIds]
              properties:
                items:
                  type: array
                  items:
                    type: object
                    required: [type, id]
                    properties:
                      type:
                        type: string
                        enum: [channel, playlist, video]
                      id:
                        type: string
                categoryIds:
                  type: array
                  items:
                    type: string
      responses:
        '200':
          description: Bulk action results

  /admin/content/bulk/reorder:
    post:
      summary: Bulk reorder content items
      description: |
        Update display order for multiple content items. Lower displayOrder values appear first.

        **Sorting Behavior:**
        - displayOrder is scoped globally across all content types
        - Items with the same displayOrder are sorted by creation date (newest first)
        - displayOrder is null until explicitly set via this endpoint

        **Error Handling:**
        - Returns 400 if any content item ID does not exist
        - Returns 400 if displayOrder values are negative
      operationId: bulkReorderContent
      tags: [Content Library]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [items]
              properties:
                items:
                  type: array
                  minItems: 1
                  items:
                    type: object
                    required: [type, id, displayOrder]
                    properties:
                      type:
                        type: string
                        enum: [channel, playlist, video]
                        description: Content type
                      id:
                        type: string
                        description: Document ID of the content item
                      displayOrder:
                        type: integer
                        minimum: 0
                        description: New display order position (lower values appear first)
      responses:
        '200':
          description: Reorder results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BulkActionResponse'
        '400':
          description: Invalid request - missing or invalid items
        '401':
          description: Not authenticated
        '403':
          description: Requires ADMIN role
        '503':
          description: Service temporarily unavailable - Firestore or backend service is unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BulkActionResponse'

  /admin/content/{type}/{id}/keywords:
    put:
      summary: Update keywords/tags for a content item
      description: |
        Update the keywords (tags) for a channel, playlist, or video.
        Keywords improve search accuracy by providing additional searchable terms.

        **Auto-enrichment:**
        Keywords can be auto-populated from YouTube tags during import if not provided.
        This endpoint allows manual override/editing of keywords.

        **Validation:**
        - Maximum 50 keywords per item
        - Each keyword max 100 characters
        - Empty/whitespace keywords are filtered out
      operationId: updateKeywords
      tags: [Content Library]
      parameters:
        - name: type
          in: path
          required: true
          schema:
            type: string
            enum: [channel, playlist, video]
          description: Content type
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Document ID of the content item
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                keywords:
                  type: array
                  items:
                    type: string
                    maxLength: 100
                  maxItems: 50
                  nullable: true
                  description: List of keywords/tags. Set to null or empty array to clear.
      responses:
        '200':
          description: Keywords updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  keywords:
                    type: array
                    items:
                      type: string
        '400':
          description: Invalid request - invalid type or validation error
        '401':
          description: Not authenticated
        '403':
          description: Requires ADMIN role
        '404':
          description: Content item not found

  # ============================================================================
  # EXCLUSIONS API
  # ============================================================================

  /admin/exclusions:
    get:
      summary: List workspace exclusions
      description: |
        List all exclusions across channels and playlists with cursor-based pagination.
        Supports filtering by parent type, exclude type, and search term.
      operationId: listExclusions
      tags: [Exclusions]
      parameters:
        - name: cursor
          in: query
          schema:
            type: string
          description: Pagination cursor from previous response
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
            minimum: 1
            maximum: 200
          description: Maximum results per page (default 50, max 200)
        - name: parentType
          in: query
          schema:
            type: string
            enum: [CHANNEL, PLAYLIST]
          description: Filter by parent type
        - name: excludeType
          in: query
          schema:
            type: string
            enum: [VIDEO, PLAYLIST]
          description: Filter by excluded content type
        - name: search
          in: query
          schema:
            type: string
          description: Search term for filtering
      responses:
        '200':
          description: Paginated list of exclusions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExclusionPage'
        '400':
          description: Invalid cursor (non-numeric or negative value)
        '401':
          description: Not authenticated
        '403':
          description: Requires ADMIN role
        '503':
          description: Service unavailable (timeout or database error)
    post:
      summary: Create an exclusion
      description: |
        Add a new exclusion to a channel or playlist.
        The exclusion will prevent the specified content from appearing when browsing the parent.
      operationId: createExclusion
      tags: [Exclusions]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateExclusionRequest'
      responses:
        '200':
          description: Exclusion already existed (idempotent no-op). No mutation occurred.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkspaceExclusion'
        '201':
          description: Exclusion created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkspaceExclusion'
        '400':
          description: Invalid request (missing required fields or invalid parent/exclude type)
        '401':
          description: Not authenticated
        '403':
          description: Requires ADMIN role

  /admin/exclusions/{id}:
    delete:
      summary: Remove an exclusion
      description: |
        Delete an exclusion by its composite ID.
        ID format: "parentType:parentId:storageType:excludeId" (single colon delimiter).
        The excluded content will again be visible when browsing the parent.
      operationId: removeExclusion
      tags: [Exclusions]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Composite exclusion ID (e.g., "CHANNEL:abc123:VIDEO:xyz789")
      responses:
        '204':
          description: Exclusion removed successfully
        '400':
          description: Invalid ID format
        '401':
          description: Not authenticated
        '403':
          description: Requires ADMIN role
        '404':
          description: Parent not found

# ==============================================================================
# COMPONENT SCHEMAS
# ==============================================================================

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Firebase Authentication JWT token

  schemas:
    HomeCategoryDto:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        slug:
          type: string
        localizedNames:
          type: object
          additionalProperties:
            type: string
          nullable: true
        displayOrder:
          type: integer
          nullable: true
        icon:
          type: string
          nullable: true
        items:
          type: array
          items:
            $ref: '#/components/schemas/ContentItemDto'
        totalContentCount:
          type: integer

    CategorySortDto:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        icon:
          type: string
          nullable: true
        localizedNames:
          type: object
          additionalProperties:
            type: string
          nullable: true
        displayOrder:
          type: integer
          nullable: true
        contentCount:
          type: integer

    ContentSortDto:
      type: object
      properties:
        contentId:
          type: string
        contentType:
          type: string
          enum: [channel, playlist, video]
        title:
          type: string
        thumbnailUrl:
          type: string
          nullable: true
        position:
          type: integer
        youtubeId:
          type: string

    Category:
      type: object
      required: [id, name]
      properties:
        id:
          type: string
        name:
          type: string
        slug:
          type: string
          nullable: true
        parentCategoryId:
          type: string
          nullable: true
          description: Parent category ID (null for top-level categories)
        topLevel:
          type: boolean
          default: false
          description: True if this is a root category (no parent)
        hasSubcategories:
          type: boolean
          default: false
        icon:
          type: string
          nullable: true
          description: Emoji or icon identifier
        displayOrder:
          type: integer
          nullable: true
          description: Sort order within parent category. Null until explicitly set.
        localizedNames:
          type: object
          nullable: true
          additionalProperties:
            type: string
          description: Localized category names (en, ar, nl)
          example:
            en: Islamic Knowledge
            ar: Ø§Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©
            nl: Islamitische Kennis
        createdBy:
          type: string
          nullable: true
          description: UID of user who created this category
        updatedBy:
          type: string
          nullable: true
          description: UID of user who last updated this category
        createdAt:
          type: string
          format: date-time
          nullable: true
        updatedAt:
          type: string
          format: date-time
          nullable: true

    CategoryDto:
      type: object
      description: Simplified category DTO for public API (read-only, excludes admin metadata)
      required: [id, name, slug]
      properties:
        id:
          type: string
          description: Firestore document ID
        name:
          type: string
          description: Category display name
        slug:
          type: string
          description: URL-friendly identifier (auto-generated from name if not provided)
        parentId:
          type: string
          nullable: true
          description: Parent category ID (null for top-level categories)

    Channel:
      type: object
      required: [id, youtubeId, name]
      properties:
        id:
          type: string
        youtubeId:
          type: string
          description: YouTube channel ID
        name:
          type: string
          description: Channel name/title
        description:
          type: string
          nullable: true
        thumbnailUrl:
          type: string
          nullable: true
        subscribers:
          type: integer
          format: int64
          nullable: true
          description: Subscriber count
        videoCount:
          type: integer
          nullable: true
          description: Number of videos in this channel
        categoryIds:
          type: array
          items:
            type: string
          description: List of category IDs this channel belongs to
        keywords:
          type: array
          items:
            type: string
          nullable: true
          description: Search keywords/tags for this channel. Auto-populated from YouTube tags during import if not provided.
        status:
          type: string
          enum: [APPROVED, PENDING, REJECTED]
          default: PENDING
          description: Approval status of the channel
        excludedItems:
          $ref: '#/components/schemas/ExcludedItems'
          nullable: true
          description: Items to exclude from this channel
        submittedBy:
          type: string
          nullable: true
          description: UID of user who submitted this channel
        approvedBy:
          type: string
          nullable: true
          description: UID of user who approved this channel
        approvalMetadata:
          $ref: '#/components/schemas/ApprovalMetadata'
          nullable: true
          description: Detailed approval/rejection metadata
        createdAt:
          type: string
          format: date-time
          nullable: true
        updatedAt:
          type: string
          format: date-time
          nullable: true
        displayOrder:
          type: integer
          nullable: true
          description: Integer sort order. Lower values appear first. Null until explicitly set.

    Playlist:
      type: object
      required: [id, youtubeId, title]
      properties:
        id:
          type: string
        youtubeId:
          type: string
          description: YouTube playlist ID
        title:
          type: string
        description:
          type: string
          nullable: true
        thumbnailUrl:
          type: string
          nullable: true
        itemCount:
          type: integer
          nullable: true
          description: Number of videos in this playlist
        categoryIds:
          type: array
          items:
            type: string
          description: List of category IDs this playlist belongs to
        keywords:
          type: array
          items:
            type: string
          nullable: true
          description: Search keywords/tags for this playlist.
        channelId:
          type: string
          nullable: true
          description: ID of the channel that owns this playlist
        status:
          type: string
          enum: [APPROVED, PENDING, REJECTED]
          default: PENDING
          description: Approval status of the playlist
        excludedVideoIds:
          type: array
          items:
            type: string
          nullable: true
          description: YouTube video IDs to exclude from this playlist
        submittedBy:
          type: string
          nullable: true
          description: UID of user who submitted this playlist
        approvedBy:
          type: string
          nullable: true
          description: UID of user who approved this playlist
        approvalMetadata:
          $ref: '#/components/schemas/ApprovalMetadata'
          nullable: true
          description: Detailed approval/rejection metadata
        createdAt:
          type: string
          format: date-time
          nullable: true
        updatedAt:
          type: string
          format: date-time
          nullable: true
        displayOrder:
          type: integer
          nullable: true
          description: Integer sort order. Lower values appear first. Null until explicitly set.

    Video:
      type: object
      required: [id, youtubeId, title]
      properties:
        id:
          type: string
        youtubeId:
          type: string
          description: YouTube video ID
        title:
          type: string
        description:
          type: string
          nullable: true
        thumbnailUrl:
          type: string
          nullable: true
        durationSeconds:
          type: integer
          nullable: true
          description: Video duration in seconds
        uploadedAt:
          type: string
          format: date-time
          nullable: true
          description: When the video was uploaded to YouTube
        viewCount:
          type: integer
          format: int64
          nullable: true
        channelId:
          type: string
          nullable: true
          description: YouTube channel ID that owns this video
        channelTitle:
          type: string
          nullable: true
          description: Channel name (cached from YouTube)
        categoryIds:
          type: array
          items:
            type: string
          description: List of category IDs this video belongs to
        keywords:
          type: array
          items:
            type: string
          nullable: true
          description: Search keywords/tags for this video. Auto-populated from YouTube tags during import if not provided.
        status:
          type: string
          enum: [APPROVED, PENDING, REJECTED, UNAVAILABLE]
          default: PENDING
          description: Approval/availability status of the video
        validationStatus:
          type: string
          enum: [VALID, UNAVAILABLE, ERROR]
          nullable: true
          description: Whether the video still exists on YouTube (VALID=accessible, UNAVAILABLE=deleted/private, ERROR=validation failed, null=not yet validated)
        lastValidatedAt:
          type: string
          format: date-time
          nullable: true
          description: Last time this video was validated against YouTube API
        submittedBy:
          type: string
          nullable: true
          description: UID of user who submitted this video
        approvedBy:
          type: string
          nullable: true
          description: UID of user who approved this video
        createdAt:
          type: string
          format: date-time
          nullable: true
        updatedAt:
          type: string
          format: date-time
          nullable: true
        displayOrder:
          type: integer
          nullable: true
          description: Integer sort order. Lower values appear first. Null until explicitly set.

    ExcludedItems:
      type: object
      description: Items to exclude from a channel (videos, playlists, etc.)
      properties:
        videos:
          type: array
          items:
            type: string
          description: YouTube video IDs to exclude
          default: []
        playlists:
          type: array
          items:
            type: string
          description: YouTube playlist IDs to exclude
          default: []
        liveStreams:
          type: array
          items:
            type: string
          description: YouTube livestream IDs to exclude
          default: []
        shorts:
          type: array
          items:
            type: string
          description: YouTube Shorts IDs to exclude
          default: []
        posts:
          type: array
          items:
            type: string
          description: YouTube community post IDs to exclude
          default: []

    # YouTube Search & Preview DTOs
    EnrichedSearchResult:
      type: object
      description: Unified search result with enriched metadata from YouTube
      properties:
        id:
          type: string
          description: YouTube ID (channel/playlist/video)
        type:
          type: string
          enum: [channel, playlist, video]
          description: Type of content
        title:
          type: string
        description:
          type: string
          nullable: true
        thumbnailUrl:
          type: string
          nullable: true
        publishedAt:
          type: string
          format: date-time
          nullable: true
        channelId:
          type: string
          nullable: true
          description: Channel ID (for videos/playlists)
        channelTitle:
          type: string
          nullable: true
          description: Channel name (for videos/playlists)
        subscriberCount:
          type: integer
          format: int64
          nullable: true
          description: Subscriber count (channels only)
        videoCount:
          type: integer
          format: int64
          nullable: true
          description: Video count (channels only)
        itemCount:
          type: integer
          format: int64
          nullable: true
          description: Item count (playlists only)
        viewCount:
          type: integer
          format: int64
          nullable: true
          description: View count (videos only)
        duration:
          type: string
          nullable: true
          description: ISO 8601 duration (videos only, e.g., PT4M13S)
        videoThumbnails:
          type: array
          items:
            type: string
          nullable: true
          description: First 4 video thumbnails (playlists only)

    SearchPageResponse:
      type: object
      description: Paginated search response with next page token
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/EnrichedSearchResult'
        nextPageToken:
          type: string
          nullable: true
          description: Token for fetching next page (null if last page)
        totalResults:
          type: integer
          nullable: true
          description: Estimated total results

    ChannelDetailsDto:
      type: object
      description: Full channel details from YouTube
      properties:
        id:
          type: string
        name:
          type: string
        url:
          type: string
        description:
          type: string
          nullable: true
        thumbnailUrl:
          type: string
          nullable: true
        bannerUrl:
          type: string
          nullable: true
        subscriberCount:
          type: integer
          format: int64
          nullable: true
        streamCount:
          type: integer
          format: int64
          nullable: true
          description: Number of videos/streams in channel
        tags:
          type: array
          items:
            type: string
          nullable: true

    PaginatedStreamItems:
      type: object
      description: Paginated response for stream/video items
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/StreamItemDto'
        nextPageToken:
          type: string
          nullable: true
          description: Token for fetching next page (null if last page)

    PaginatedPlaylistItems:
      type: object
      description: Paginated response for playlist items
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/PlaylistItemDto'
        nextPageToken:
          type: string
          nullable: true
          description: Token for fetching next page (null if last page)

    StreamItemDto:
      type: object
      description: Lightweight video/stream item for lists
      properties:
        id:
          type: string
        name:
          type: string
        url:
          type: string
        thumbnailUrl:
          type: string
          nullable: true
        uploaderName:
          type: string
          nullable: true
        uploaderUrl:
          type: string
          nullable: true
        viewCount:
          type: integer
          format: int64
          nullable: true
        duration:
          type: integer
          format: int64
          nullable: true
          description: Duration in seconds
        uploadDate:
          type: string
          format: date-time
          nullable: true
        streamType:
          type: string
          nullable: true
          description: Content type - VIDEO, SHORT, or LIVESTREAM
          enum: [VIDEO, SHORT, LIVESTREAM]

    PlaylistItemDto:
      type: object
      description: Lightweight playlist item for lists
      properties:
        id:
          type: string
        name:
          type: string
        url:
          type: string
        thumbnailUrl:
          type: string
          nullable: true
        uploaderName:
          type: string
          nullable: true
        streamCount:
          type: integer
          format: int64
          nullable: true

    PlaylistDetailsDto:
      type: object
      description: Full playlist details from YouTube
      properties:
        id:
          type: string
        name:
          type: string
        url:
          type: string
        description:
          type: string
          nullable: true
        thumbnailUrl:
          type: string
          nullable: true
        uploaderName:
          type: string
          nullable: true
        uploaderUrl:
          type: string
          nullable: true
        streamCount:
          type: integer
          format: int64
          nullable: true
        relatedStreams:
          type: array
          items:
            $ref: '#/components/schemas/StreamItemDto'
          nullable: true

    StreamDetailsDto:
      type: object
      description: Full video/stream details from YouTube
      properties:
        id:
          type: string
        name:
          type: string
        url:
          type: string
        description:
          type: string
          nullable: true
        thumbnailUrl:
          type: string
          nullable: true
        uploaderName:
          type: string
          nullable: true
        uploaderUrl:
          type: string
          nullable: true
        viewCount:
          type: integer
          format: int64
          nullable: true
        duration:
          type: integer
          format: int64
          nullable: true
          description: Duration in seconds
        uploadDate:
          type: string
          format: date-time
          nullable: true
        likeCount:
          type: integer
          format: int64
          nullable: true
        dislikeCount:
          type: integer
          format: int64
          nullable: true
        category:
          type: string
          nullable: true
        tags:
          type: array
          items:
            type: string
          nullable: true

    ExistingContentRequest:
      type: object
      description: Request to check which YouTube IDs already exist in registry
      properties:
        channelIds:
          type: array
          items:
            type: string
          default: []
        playlistIds:
          type: array
          items:
            type: string
          default: []
        videoIds:
          type: array
          items:
            type: string
          default: []

    ExistingContentResponse:
      type: object
      description: Response indicating which YouTube IDs already exist
      properties:
        existingChannels:
          type: array
          items:
            type: string
          description: YouTube channel IDs that already exist
        existingPlaylists:
          type: array
          items:
            type: string
          description: YouTube playlist IDs that already exist
        existingVideos:
          type: array
          items:
            type: string
          description: YouTube video IDs that already exist

    # Content Library DTOs
    ContentLibraryResponse:
      type: object
      description: |
        Paginated response for content library. The `truncated` field indicates whether
        results may be incomplete due to bounded query limits (max 200 per content type).
        UI should display a warning to users when `truncated` is true.
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/ContentItem'
        totalItems:
          type: integer
          description: Total count of items matching filters within the bounded query window
        currentPage:
          type: integer
          description: Current page number (0-indexed)
        pageSize:
          type: integer
          description: Number of items per page
        totalPages:
          type: integer
          description: Total number of pages within the bounded query window
        truncated:
          type: boolean
          description: |
            Indicates whether results may be incomplete due to bounded query limits.
            When true, the server capped results to prevent Firestore quota exhaustion,
            and there may be more items matching the filters than shown. UI should
            display a message like "Showing most recent results. Use filters or search
            to find specific items." when this is true.

    ContentItem:
      type: object
      description: Unified content item (channel/playlist/video) for content library
      properties:
        type:
          type: string
          enum: [channel, playlist, video]
        id:
          type: string
        youtubeId:
          type: string
          description: YouTube ID for video preview/player functionality
        title:
          type: string
        description:
          type: string
          nullable: true
        thumbnailUrl:
          type: string
          nullable: true
        status:
          type: string
          enum: [APPROVED, PENDING, REJECTED, UNAVAILABLE]
        categoryIds:
          type: array
          items:
            type: string
        createdAt:
          type: string
          format: date-time
          nullable: true
        count:
          type: integer
          format: int64
          nullable: true
          description: Subscriber/video/view count depending on content type
        displayOrder:
          type: integer
          nullable: true
          description: Integer sort order. Lower values appear first. Null until explicitly set.
        keywords:
          type: array
          items:
            type: string
          nullable: true
          description: Search keywords/tags for improved search accuracy. Auto-populated from YouTube tags during import if not provided.

    BulkActionRequest:
      type: object
      description: Request for bulk operations (approve/reject/delete)
      required: [items]
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/BulkActionItem'
          minItems: 1

    BulkActionItem:
      type: object
      description: Single item in a bulk action request
      required: [type, id]
      properties:
        type:
          type: string
          enum: [channel, playlist, video]
        id:
          type: string

    BulkCategoryAssignmentRequest:
      type: object
      description: Request for bulk category assignment
      required: [items, categoryIds]
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/BulkActionItem'
          minItems: 1
        categoryIds:
          type: array
          items:
            type: string
          description: Category IDs to assign to all items

    BulkActionResponse:
      type: object
      description: Response for bulk operations
      properties:
        successCount:
          type: integer
          description: Number of successfully processed items
        errors:
          type: array
          items:
            type: string
          description: List of error messages for failed items

    # Exclusion DTOs
    WorkspaceExclusion:
      type: object
      description: A single exclusion in the workspace
      required: [id, parentType, parentId, excludeType, excludeId]
      properties:
        id:
          type: string
          description: Composite ID in format "parentType:parentId:storageType:excludeId"
          example: "CHANNEL:abc123:VIDEO:xyz789"
        parentType:
          type: string
          enum: [CHANNEL, PLAYLIST]
          description: Type of parent entity
        parentId:
          type: string
          description: Internal ID of the parent channel or playlist
        parentYoutubeId:
          type: string
          nullable: true
          description: YouTube ID of the parent channel or playlist
        parentName:
          type: string
          nullable: true
          description: Name of the parent channel or playlist
        excludeType:
          type: string
          enum: [VIDEO, PLAYLIST]
          description: Type of excluded content
        excludeId:
          type: string
          description: YouTube ID of the excluded content
        reason:
          type: string
          nullable: true
          enum: [LIVESTREAM, SHORT, POST, null]
          description: Content sub-type reason (LIVESTREAM, SHORT, POST, or null for plain video/playlist)
        createdAt:
          type: string
          format: date-time
          nullable: true
          description: Best-available timestamp for the exclusion. Currently derived from the parent entity's updatedAt field (not per-exclusion creation time).
        createdBy:
          nullable: true
          description: Reserved for future use. Currently always null (per-exclusion creator tracking is not implemented).
          oneOf:
            - $ref: '#/components/schemas/AdminUserSummary'
            - type: 'null'

    AdminUserSummary:
      type: object
      description: Simplified admin user info for display
      properties:
        id:
          type: string
          description: User ID
        email:
          type: string
          nullable: true
          description: User email
        displayName:
          type: string
          nullable: true
          description: User display name

    CreateExclusionRequest:
      type: object
      description: Request body for creating an exclusion
      required: [parentType, parentId, excludeType, excludeId]
      properties:
        parentType:
          type: string
          enum: [CHANNEL, PLAYLIST]
          description: Type of parent entity
        parentId:
          type: string
          description: Internal ID of the parent channel or playlist
        excludeType:
          type: string
          enum: [VIDEO, PLAYLIST]
          description: Type of content to exclude
        excludeId:
          type: string
          description: YouTube ID of the content to exclude
        reason:
          type: string
          nullable: true
          enum: [LIVESTREAM, SHORT, POST]
          description: Content sub-type reason. Routes VIDEO exclusions to the correct storage list (e.g., LIVESTREAM to liveStreams)

    ExclusionPage:
      type: object
      description: Cursor-paginated list of exclusions
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/WorkspaceExclusion'
        pageInfo:
          type: object
          properties:
            nextCursor:
              type: string
              nullable: true
              description: Cursor for fetching the next page (null if no more pages)
            hasNext:
              type: boolean
              description: Whether more pages are available
            totalCount:
              type: integer
              nullable: true
              description: Total count of matching items (may not always be available)
            truncated:
              type: boolean
              nullable: true
              description: Whether results were truncated due to safety limits (e.g., max 500 channels). When true, totalCount and results may be incomplete.

    # Download DTOs
    DownloadTokenRequest:
      type: object
      description: Request body for generating download token
      required: [eulaAccepted]
      properties:
        eulaAccepted:
          type: boolean
          description: User confirmation of EULA acceptance (must be true)

    DownloadTokenDto:
      type: object
      description: Download authorization token with expiration
      properties:
        token:
          type: string
          description: JWT token for authorizing downloads
        expiresAtMillis:
          type: integer
          format: int64
          description: Token expiration time in milliseconds since epoch (UTC)
        videoId:
          type: string
          description: Video ID this token is valid for

    DownloadManifestDto:
      type: object
      description: Video download manifest with stream options
      properties:
        videoId:
          type: string
        title:
          type: string
        expiresAtMillis:
          type: integer
          format: int64
          description: Manifest expiration time in milliseconds since epoch (UTC). URLs become invalid after this.
        videoStreams:
          type: array
          items:
            $ref: '#/components/schemas/StreamOption'
          description: Available video quality options
        audioStreams:
          type: array
          items:
            $ref: '#/components/schemas/StreamOption'
          description: Available audio quality options

    StreamOption:
      type: object
      description: |
        Stream quality option for downloads.

        For progressive streams (â‰¤480p): progressiveUrl is non-null, requiresMerging is false.
        For split streams (>480p): videoUrl and audioUrl are non-null, requiresMerging is true.
      properties:
        id:
          type: string
          description: Unique identifier for this stream option
        qualityLabel:
          type: string
          description: Quality label (e.g., "720p", "480p", "192kbps")
        mimeType:
          type: string
          description: MIME type (e.g., "video/mp4", "audio/m4a")
        requiresMerging:
          type: boolean
          description: True if separate audio+video URLs need FFmpeg merging
        progressiveUrl:
          type: string
          nullable: true
          description: Progressive stream URL (non-null when requiresMerging == false)
        videoUrl:
          type: string
          nullable: true
          description: Video-only stream URL (non-null when requiresMerging == true)
        audioUrl:
          type: string
          nullable: true
          description: Audio-only stream URL (non-null when requiresMerging == true)
        fileSize:
          type: integer
          format: int64
          description: File size in bytes
        bitrate:
          type: integer
          description: Bitrate in kbps

    DownloadPolicyDto:
      type: object
      description: Download permission policy for a video
      properties:
        allowed:
          type: boolean
          description: Whether download is allowed
        reason:
          type: string
          description: Reason for policy decision
        requiresEula:
          type: boolean
          description: Whether EULA acceptance is required

    DownloadStartedEvent:
      type: object
      description: Event data for tracking download started
      required:
        - videoId
        - quality
      properties:
        videoId:
          type: string
          description: YouTube video ID
        quality:
          type: string
          description: Selected quality (e.g., "720p", "1080p")
        deviceType:
          type: string
          description: Device type (e.g., "mobile", "tablet", "desktop")
          default: unknown

    DownloadCompletedEvent:
      type: object
      description: Event data for tracking download completed
      required:
        - videoId
        - quality
      properties:
        videoId:
          type: string
          description: YouTube video ID
        quality:
          type: string
          description: Selected quality (e.g., "720p", "1080p")
        fileSize:
          type: integer
          format: int64
          description: Downloaded file size in bytes
          nullable: true
        deviceType:
          type: string
          description: Device type (e.g., "mobile", "tablet", "desktop")
          default: unknown

    DownloadFailedEvent:
      type: object
      description: Event data for tracking download failed
      required:
        - videoId
      properties:
        videoId:
          type: string
          description: YouTube video ID
        errorReason:
          type: string
          description: Reason for download failure
        deviceType:
          type: string
          description: Device type (e.g., "mobile", "tablet", "desktop")
          default: unknown

    # Pagination & Player DTOs
    CursorPageDto:
      type: object
      description: Generic cursor-based pagination wrapper
      properties:
        data:
          type: array
          items:
            type: object
          description: Array of items (type varies by endpoint)
        pageInfo:
          $ref: '#/components/schemas/PageInfo'

    PageInfo:
      type: object
      description: Pagination metadata for cursor-based pagination
      required:
        - hasNext
      properties:
        nextCursor:
          type: string
          nullable: true
          description: Cursor for fetching next page (null if last page)
        hasNext:
          type: boolean
          description: Whether more pages are available
        totalCount:
          type: integer
          nullable: true
          description: Total count of items matching current filters (optional, returned by some endpoints)
        truncated:
          type: boolean
          nullable: true
          description: |
            Indicates whether results were truncated due to safety limits.
            When true, the totalCount and results may be incomplete.
            Used by workspace exclusions aggregation to signal when hard limits
            (e.g., 500 channels, 1000 playlists) have been hit.

    NextUpDto:
      type: object
      description: Next-up video recommendations (cursor-paginated)
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/VideoItem'
          description: Array of recommended videos
        pageInfo:
          $ref: '#/components/schemas/PageInfo'

    VideoItem:
      type: object
      description: Lightweight video item for next-up queue
      properties:
        id:
          type: string
        title:
          type: string
        channelName:
          type: string
        durationSeconds:
          type: integer
        thumbnailUrl:
          type: string
        category:
          type: string

    # Approval Workflow DTOs
    ApprovalMetadata:
      type: object
      description: Metadata about approval/rejection actions (embedded in Channel/Playlist documents)
      properties:
        reviewedBy:
          type: string
          nullable: true
          description: Firebase UID of the reviewer
        reviewerDisplayName:
          type: string
          nullable: true
          description: Display name of the reviewer (cached)
        reviewedAt:
          type: string
          format: date-time
          nullable: true
          description: Timestamp when the review happened
        reviewNotes:
          type: string
          nullable: true
          description: Review notes from the moderator
        rejectionReason:
          type: string
          nullable: true
          enum: [NOT_ISLAMIC, LOW_QUALITY, DUPLICATE, OTHER]
          description: Rejection reason (for rejected items)

    PendingApprovalDto:
      type: object
      description: Pending approval item
      properties:
        id:
          type: string
        type:
          type: string
          enum: [CHANNEL, PLAYLIST, VIDEO]
        entityId:
          type: string
          description: ID of the actual channel/playlist/video
        title:
          type: string
        category:
          type: string
        submittedAt:
          type: string
          format: date-time
        submittedBy:
          type: string
        metadata:
          type: object
          additionalProperties: true
          description: Additional metadata (subscribers, video count, etc.)

    ApprovalRequestDto:
      type: object
      description: Request to approve a pending item
      properties:
        reviewNotes:
          type: string
          description: Review notes (required for approval)
        categoryOverride:
          type: string
          nullable: true
          description: Optional category override

    ApprovalResponseDto:
      type: object
      description: Response after approval action
      properties:
        success:
          type: boolean
        message:
          type: string
        entityId:
          type: string
          nullable: true

    RejectionRequestDto:
      type: object
      description: Request to reject a pending item
      properties:
        reason:
          type: string
          description: Reason for rejection (required)

    # Public API Response Wrappers
    ChannelDetailResponse:
      type: object
      description: Channel details with associated playlists
      properties:
        channel:
          $ref: '#/components/schemas/Channel'
        playlists:
          type: array
          items:
            $ref: '#/components/schemas/Playlist'

    PlaylistDetailResponse:
      type: object
      description: Playlist details with associated videos
      properties:
        playlist:
          $ref: '#/components/schemas/Playlist'
        videos:
          type: array
          items:
            $ref: '#/components/schemas/Video'

    ContentItemDto:
      type: object
      description: Unified DTO for content items (channels, playlists, videos) in public API. Fields are nullable to accommodate different content types.
      required: [id, type]
      properties:
        id:
          type: string
        type:
          type: string
          enum: [CHANNEL, PLAYLIST, VIDEO]
          description: Content type discriminator
        # Common fields
        title:
          type: string
          nullable: true
          description: Title for playlists and videos
        name:
          type: string
          nullable: true
          description: Name for channels
        category:
          type: string
          nullable: true
          description: Category name
        description:
          type: string
          nullable: true
        thumbnailUrl:
          type: string
          nullable: true
        # Video-specific fields
        durationSeconds:
          type: integer
          nullable: true
          description: Video duration in seconds (videos only)
        uploadedDaysAgo:
          type: integer
          nullable: true
          description: Days since upload (videos only)
        viewCount:
          type: integer
          format: int64
          nullable: true
          description: View count (videos only)
        # Channel-specific fields
        subscribers:
          type: integer
          format: int64
          nullable: true
          description: Subscriber count (channels only)
        videoCount:
          type: integer
          nullable: true
          description: Number of videos (channels only)
        # Playlist-specific fields
        itemCount:
          type: integer
          nullable: true
          description: Number of items (playlists only)

    ContentDto:
      type: object
      description: Polymorphic content item (channel/playlist/video) for public API
      oneOf:
        - $ref: '#/components/schemas/Channel'
        - $ref: '#/components/schemas/Playlist'
        - $ref: '#/components/schemas/Video'

    User:
      type: object
      properties:
        uid:
          type: string
        email:
          type: string
        displayName:
          type: string
        role:
          type: string
          enum: [admin, moderator]
        status:
          type: string
          enum: [active, inactive]
        createdAt:
          type: string
          format: date-time

    AuditLog:
      type: object
      properties:
        id:
          type: string
        actorUid:
          type: string
        actorEmail:
          type: string
        action:
          type: string
        entityType:
          type: string
        entityId:
          type: string
        timestamp:
          type: string
          format: date-time
        metadata:
          type: object

    ErrorResponse:
      type: object
      description: Generic error response for 4xx and 5xx errors
      properties:
        error:
          type: string
          description: Error type or code
        message:
          type: string
          description: Human-readable error message
        details:
          type: object
          nullable: true
          description: Additional error context (optional)

  responses:
    UnauthorizedError:
      description: Authentication required or token invalid
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
              message:
                type: string

    ForbiddenError:
      description: Insufficient permissions
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
              message:
                type: string
